var
  glob = require('glob'),
  fs = require('fs'),
  paths = require('./components.js')

var VueAutoInstall = {
  getName (path) {
    var splittedPath = path.split('/')
    var n = splittedPath[splittedPath.length - 1]
    var name = n.split('.')[0]
    return name
  },
  createFile () {
    var self = this
    var target = paths.basePath

    glob(target, function (er, files) {
      var docs = []

      files.forEach(function (file) {
        var newFile = {}

        newFile.name = self.getName(file)
        newFile.path = file.split('components/')[1]
        docs.push(newFile)
      })

      var stringFile = self.createContent(docs)
      fs.writeFile(paths.filename, stringFile, function (err) {
        if (err) {
          console.log('\n \n > there was an error saving files ', err)
        }
        else {
          console.log('\n \n > Creating paths for each component...')
          console.log('\n > ' + paths.filename + ' has been generated \n')
        }
      })
    })
  },
  createContent (body) {
    return '//DO NOT UPDATE THIS FILE \n // This file is AUTOGENERATED \n\n export default' + JSON.stringify(body);
  }
}

VueAutoInstall.createFile();
